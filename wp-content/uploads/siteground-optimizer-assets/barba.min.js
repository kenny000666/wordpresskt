!function(b,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):b.barba=a()}(this,function(){var y=function(){function a(){}return a.prototype.then=function(d,e){var b=new a,f=this.s,g;if(f){if(g=1&f?d:e,g){try{c(b,1,g(this.v))}catch(a){c(b,2,a)}return b}return this}return this.o=function(f){try{var a=f.v;1&f.s?c(b,1,d?d(a):a):e?c(b,1,e(a)):c(b,2,a)}catch(a){c(b,2,a)}},b},a}(),i,B,H,b,m,f,o,$,_,Z,A,N,h,e,r,q,L,ad,C,u,v,s,F,G,aa,x,Q,l,w,K,O,P,ae,R,S,T,U,V,W,X,Y,p,k,d,n,E,ac,a,z;function c(b,d,a){if(!b.s){if(a instanceof y){if(!a.s)return void(a.o=c.bind(null,b,d));1&d&&(d=a.s),a=a.v}if(a&&a.then)return void a.then(c.bind(null,b,d),c.bind(null,b,2));b.s=d,b.v=a;var e=b.o;e&&e(b)}}function j(c,b){try{var a=c()}catch(a){return b(a)}return a&&a.then?a.then(void 0,b):a}B={},!function(){function a(a){this.t=a,this.i=null,this.u=null,this.h=null,this.l=null}function b(a){return{value:a,done:!0}}function d(a){return{value:a,done:!1}}a.prototype[Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))]=function(){return this},a.prototype.p=function(a){return this.u(a&&a.then?a.then(d):d(a)),this.i=new y},a.prototype.next=function(d){var a=this;return a.l=new Promise(function(e){var f=a.i,g;if(null===f){if(g=a.t,null===g)return e(a.l);function h(c){a.u(c&&c.then?c.then(b):b(c)),a.i=null,a.u=null}a.t=null,a.u=e,g(a).then(h,function(b){if(b===B)h(a.h);else{var c=new y;a.u(c),a.i=null,a.u=null,_resolve(c,2,b)}})}else a.i=null,a.u=e,c(f,1,d)})},a.prototype.return=function(d){var a=this;return a.l=new Promise(function(e){var f=a.i;if(null===f)return null===a.t?e(a.l):(a.t=null,e(d&&d.then?d.then(b):b(d)));a.h=d,a.u=e,a.i=null,c(f,2,B)})},a.prototype.throw=function(b){var a=this;return a.l=new Promise(function(d,f){var e=a.i;if(null===e)return null===a.t?d(a.l):(a.t=null,f(b));a.u=d,a.i=null,c(e,2,b)})}}(),function(a){a[a.off=0]="off",a[a.error=1]="error",a[a.warning=2]="warning",a[a.info=3]="info",a[a.debug=4]="debug"}(i||(i={})),H=i.off,b=function(a){this.m=a},b.getLevel=function(){return H},b.setLevel=function(a){return H=i[a]},b.prototype.error=function(){for(var b=[],a=arguments.length;a--;)b[a]=arguments[a];this.g(console.error,i.error,b)},b.prototype.warn=function(){for(var b=[],a=arguments.length;a--;)b[a]=arguments[a];this.g(console.warn,i.warning,b)},b.prototype.info=function(){for(var b=[],a=arguments.length;a--;)b[a]=arguments[a];this.g(console.info,i.info,b)},b.prototype.debug=function(){for(var b=[],a=arguments.length;a--;)b[a]=arguments[a];this.g(console.log,i.debug,b)},b.prototype.g=function(a,c,d){c<=b.getLevel()&&a.apply(console,["["+this.m+"] "].concat(d))},m=function(){this.logger=new b("@barba/core"),this.all=["ready","page","reset","currentAdded","currentRemoved","nextAdded","nextRemoved","beforeAppear","appear","afterAppear","appearCanceled","before","beforeLeave","leave","afterLeave","leaveCanceled","beforeEnter","enter","afterEnter","enterCanceled","after"],this.registered=new Map,this.init()},m.prototype.init=function(){var a=this;this.registered.clear(),this.all.forEach(function(b){a[b]||(a[b]=function(d,c){void 0===c&&(c=null),a.registered.has(b)||a.registered.set(b,new Set),a.registered.get(b).add({ctx:c,fn:d})})})},m.prototype.do=function(b){for(var c=[],a=arguments.length-1;a-- >0;)c[a]=arguments[a+1];this.registered.has(b)&&this.registered.get(b).forEach(function(a){a.fn.apply(a.ctx,c)})},m.prototype.clear=function(){var a=this;this.all.forEach(function(b){delete a[b]}),this.init()},m.prototype.help=function(){this.logger.info("[@barba/core] Available hooks: "+this.all),this.logger.info("[@barba/core] Registered hooks: "+Object.keys(this.registered))},f=new m,o=function d(a,b,c){return a instanceof RegExp?function(b,d){var c,a;if(!d)return b;if(c=b.source.match(/\((?!\?)/g),c)for(a=0;a<c.length;a++)d.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return b}(a,b):Array.isArray(a)?function(b,f,c){for(var e=[],a=0;a<b.length;a++)e.push(d(b[a],f,c).source);return new RegExp("(?:"+e.join("|")+")",J(c))}(a,b,c):function(b,c,a){return D(t(b,a),c,a)}(a,b,c)},$=t,_=I,Z=D,A="/",N=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function t(h,c){for(var b,d=[],s=0,f=0,a="",k=c&&c.delimiter||A,q=c&&c.whitelist||void 0,j=!1,v,r,o,l,u,w,t,e,m,p,n,i;null!==(b=N.exec(h));)v=b[0],r=b[1],o=b.index,(a+=h.slice(f,o),f=o+v.length,r)?(a+=r[1],j=!0):(l="",u=b[2],w=b[3],t=b[4],e=b[5],!j&&a.length&&(m=a.length-1,p=a[m],(!q||q.indexOf(p)>-1)&&(l=p,a=a.slice(0,m))),a&&(d.push(a),a="",j=!1),n=w||t,i=l||k,d.push({name:u||s++,prefix:l,delimiter:i,optional:"?"===e||"*"===e,repeat:"+"===e||"*"===e,pattern:n?ab(n):"[^"+g(i===k?i:i+k)+"]+?"}));return(a||f<h.length)&&d.push(a+h.substr(f)),d}function I(a){for(var c=new Array(a.length),b=0;b<a.length;b++)"object"==typeof a[b]&&(c[b]=new RegExp("^(?:"+a[b].pattern+")$"));return function(j,k){for(var g="",i=k&&k.encode||encodeURIComponent,f=0,b,e,d,h;f<a.length;f++)if(b=a[f],"string"!=typeof b)if(d=j?j[b.name]:void 0,Array.isArray(d)){if(!b.repeat)throw new TypeError('Expected "'+b.name+'" to not repeat, but got array');if(0===d.length){if(b.optional)continue;throw new TypeError('Expected "'+b.name+'" to not be empty')}for(h=0;h<d.length;h++){if(e=i(d[h],b),!c[f].test(e))throw new TypeError('Expected all "'+b.name+'" to match "'+b.pattern+'"');g+=(0===h?b.prefix:b.delimiter)+e}}else if("string"!=typeof d&&"number"!=typeof d&&"boolean"!=typeof d){if(!b.optional)throw new TypeError('Expected "'+b.name+'" to be '+(b.repeat?"an array":"a string"))}else{if(e=i(String(d),b),!c[f].test(e))throw new TypeError('Expected "'+b.name+'" to match "'+b.pattern+'", but got "'+e+'"');g+=b.prefix+e}else g+=b;return g}}function g(a){return a.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function ab(a){return a.replace(/([=!:$\/()])/g,"\\$1")}function J(a){return a&&a.sensitive?"":"i"}function D(h,l,b){for(var k=(b=b||{}).strict,n=!1!==b.start,m=!1!==b.end,d=b.delimiter||A,f=[].concat(b.endsWith||[]).map(g).concat("$").join("|"),c=n?"^":"",i=0,a,j,e,o;i<h.length;i++)a=h[i],"string"==typeof a?c+=g(a):(j=a.repeat?"(?:"+a.pattern+")(?:"+g(a.delimiter)+"(?:"+a.pattern+"))*":a.pattern,l&&l.push(a),c+=a.optional?a.prefix?"(?:"+g(a.prefix)+"("+j+"))?":"("+j+")?":g(a.prefix)+"("+j+")");return m?(k||(c+="(?:"+g(d)+")?"),c+="$"===f?"$":"(?="+f+")"):(e=h[h.length-1],o="string"==typeof e?e[e.length-1]===d:void 0===e,k||(c+="(?:"+g(d)+"(?="+f+"))?"),o||(c+="(?="+g(d)+"|"+f+")")),new RegExp(c,J(b))}o.parse=$,o.compile=function(a,b){return I(t(a,b))},o.tokensToFunction=_,o.tokensToRegExp=Z,h={container:"container",namespace:"namespace",prefix:"data-barba",prevent:"prevent",wrapper:"wrapper"},e=function(){this.P=h,this.A=new DOMParser},e.prototype.toString=function(a){return a.outerHTML},e.prototype.toDocument=function(a){return this.A.parseFromString(a,"text/html")},e.prototype.toElement=function(b){var a=document.createElement("div");return a.innerHTML=b,a},e.prototype.getHtml=function(a){return void 0===a&&(a=document),this.toString(a.documentElement)},e.prototype.getWrapper=function(a){return void 0===a&&(a=document),a.querySelector("["+this.P.prefix+'="'+this.P.wrapper+'"]')},e.prototype.getContainer=function(a){return void 0===a&&(a=document),a.querySelector("["+this.P.prefix+'="'+this.P.container+'"]')},e.prototype.getNamespace=function(a){void 0===a&&(a=document);var b=a.querySelector("["+this.P.prefix+"-"+this.P.namespace+"]");return b?b.getAttribute(this.P.prefix+"-"+this.P.namespace):null},e.prototype.getHref=function(a){return a.getAttribute&&a.getAttribute("href")?a.href:null},r=new e,q=function(c,a){try{var b=function(){if(!a.html)return Promise.resolve(c).then(function(b){if(b){var c=r.toElement(b);a.namespace=r.getNamespace(c),a.container=r.getContainer(c),a.html=b}})}();return Promise.resolve(b&&b.then?b.then(function(){}):void 0)}catch(a){return Promise.reject(a)}},L=o,ad={updateNext:q,pathToRegexp:L},C=function(){return window.location.origin},u=function(b){var a=b||window.location.port,c=window.location.protocol;return""!==a?parseInt(a,10):"https:"===c?443:80},v=function(a){return s(a).path},s=function(f){var d,a=G(f),e={},b=a.indexOf("#"),c;return b>=0&&(d=a.slice(b+1),a=a.slice(0,b)),c=a.indexOf("?"),c>=0&&(e=F(a.slice(c+1)),a=a.slice(0,c)),{hash:d,path:a,query:e}},F=function(a){return a.split("&").reduce(function(a,c){var b=c.split("=");return a[b[0]]=b[1],a},{})},G=function(b,a){return void 0===a&&(a=C()),b.replace(a,"")},aa={getHref:function(){return window.location.href},getOrigin:C,getPort:u,getPath:v,parse:s,parseQuery:F,clean:G},x=function(a){if(this.T=[],"boolean"==typeof a)this.j=a;else{var b=Array.isArray(a)?a:[a];this.T=b.map(function(a){return L(a)})}},x.prototype.checkUrl=function(a){if("boolean"==typeof this.j)return this.j;var b=s(a).path;return this.T.some(function(a){return null!==a.exec(b)})},Q=function(b){function a(a){b.call(this,a),this.R=new Map}return b&&(a.__proto__=b),(a.prototype=Object.create(b&&b.prototype)).constructor=a,a.prototype.set=function(a,b){return this.checkUrl(a)||this.R.set(a,b),b},a.prototype.get=function(a){return this.R.get(a)},a.prototype.has=function(a){return this.R.has(a)},a.prototype.delete=function(a){return this.R.delete(a)},a}(x),l=function(){this.R=[]},w={current:{configurable:!0},previous:{configurable:!0}};function M(a,b,c){return void 0===b&&(b=2e3),new Promise(function(f,e){var d=new XMLHttpRequest;d.timeout=b,d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE)if(200===d.status)f(d.responseText);else if(d.status){var b={status:d.status,statusText:d.statusText};c(a,b),e(b)}},d.ontimeout=function(){var d=new Error("Timeout error ["+b+"]");c(a,d),e(d)},d.onerror=function(){var b=new Error("Fetch error");c(a,b),e(b)},d.open("GET",a),d.setRequestHeader("Accept","text/html,application/xhtml+xml,application/xml"),d.setRequestHeader("x-barba","yes"),d.send()})}return l.prototype.add=function(a,b){this.R.push({url:a,ns:b})},l.prototype.remove=function(){this.R.pop()},l.prototype.push=function(a,b){this.add(a,b),window.history&&window.history.pushState(null,"",a)},l.prototype.cancel=function(){this.remove(),window.history&&window.history.back()},w.current.get=function(){return this.R[this.R.length-1]},w.previous.get=function(){return this.R.length<2?null:this.R[this.R.length-2]},Object.defineProperties(l.prototype,w),O=function(){return!window.history.pushState},P=function(a){return!a.el||!a.href},ae=function(b){var a=b.event;return a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey},R=function(b){var a=b.el;return a.hasAttribute("target")&&"_blank"===a.target},S=function(b){var a=b.el;return window.location.protocol!==a.protocol||window.location.hostname!==a.hostname},T=function(a){var b=a.el;return u()!==u(b.port)},U=function(b){var a=b.el;return a.getAttribute&&"string"==typeof a.getAttribute("download")},V=function(a){return a.el.hasAttribute(h.prefix+"-"+h.prevent)},W=function(a){return Boolean(a.el.closest("["+h.prefix+"-"+h.prevent+'="all"]'))},X=function(a){return v(a.href)===v(window.location.href)},Y=function(b){function a(a){b.call(this,a),this.suite=[],this.tests=new Map,this.init()}return b&&(a.__proto__=b),(a.prototype=Object.create(b&&b.prototype)).constructor=a,a.prototype.init=function(){this.add("pushState",O),this.add("exists",P),this.add("newTab",ae),this.add("blank",R),this.add("corsDomain",S),this.add("corsPort",T),this.add("download",U),this.add("preventSelf",V),this.add("preventAll",W),this.add("sameUrl",X,!1)},a.prototype.add=function(b,c,a){void 0===a&&(a=!0),this.tests.set(b,c),a&&this.suite.push(b)},a.prototype.run=function(a,b,c,d){return this.tests.get(a)({el:b,event:c,href:d})},a.prototype.checkLink=function(a,b,c){var d=this;return this.suite.some(function(e){return d.run(e,a,b,c)})},a}(x),p=(function(b){var a=b.exports=function(b,a){return a=a||function(){},function(){var c=!1,e=arguments,d=new Promise(function(d,g){var a,f=b.apply({async:function(){return c=!0,function(a,b){a?g(a):d(b)}}},Array.prototype.slice.call(e));c||(!(a=f)||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then?d(f):f.then(d,g))});return d.then(a.bind(null,null),a),d}};a.cb=function(b,c){return a(function(){var a=Array.prototype.slice.call(arguments);return a.length===b.length-1&&a.push(this.async()),b.apply(this,a)},c)}}(K={exports:{}}),K.exports),k=function(a){void 0===a&&(a=[]),this.logger=new b("@barba/core"),this.all=[],this.appear=[],this.O=[{name:"namespace",type:"strings"},{name:"custom",type:"function"}],a&&(this.all=this.all.concat(a)),this.k()},k.prototype.add=function(b,a){switch(b){case"rule":this.O.splice(a.position||0,0,a.value);break;case"transition":default:this.all.push(a)}this.k()},k.prototype.resolve=function(c,a){var b=this,e,f,g,h,d;return void 0===a&&(a={}),e=a.appear?this.appear:this.all,e=e.filter(a.self?function(a){return a.name&&"self"===a.name}:function(a){return!a.name||"self"!==a.name}),f=new Map,g=e.find(function(d){var e=!0,g={};return!(!a.self||"self"!==d.name)||(b.O.reverse().forEach(function(f){e&&(e=b.C(d,f,c,g),a.appear||(d.from&&d.to&&(e=b.C(d,f,c,g,"from")&&b.C(d,f,c,g,"to")),d.from&&!d.to&&(e=b.C(d,f,c,g,"from")),!d.from&&d.to&&(e=b.C(d,f,c,g,"to"))))}),f.set(d,g),e)}),h=f.get(g),d=[],d.push(a.appear?"appear":"page"),a.self&&d.push("self"),h?this.logger.info("Transition found ["+d.join(",")+"]",h):this.logger.info("No transition found ["+d.join(",")+"]"),g},k.prototype.k=function(){var a=this;this.all=this.all.map(function(b){return a.L(b)}).sort(function(a,b){return a.priority-b.priority}).reverse().map(function(a){return delete a.priority,a}),this.appear=this.all.filter(function(a){return a.appear})},k.prototype.C=function(p,n,k,j,c){var g=!0,h=!1,i=p,b=n.name,f=b,e=b,o=b,a=c?i[c]:i,d="to"===c?k.next:k.current,m,l;if(c?a&&a[b]:a[b]){switch(n.type){case"strings":default:m=Array.isArray(a[f])?a[f]:[a[f]],d[f]&&-1!==m.indexOf(d[f])&&(h=!0),-1===m.indexOf(d[f])&&(g=!1);break;case"object":l=Array.isArray(a[e])?a[e]:[a[e]],d[e]&&d[e].name&&-1!==l.indexOf(d[e].name)&&(h=!0),-1===l.indexOf(d[e].name)&&(g=!1);break;case"function":a[o](k)?h=!0:g=!1}h&&(c?(j[c]=j[c]||{},j[c][b]=i[c][b]):j[b]=i[b])}return g},k.prototype.M=function(a,b,d){var c=0;return(a[b]||a.from&&a.from[b]||a.to&&a.to[b])&&(c+=Math.pow(10,d),a.from&&a.from[b]&&(c+=1),a.to&&a.to[b]&&(c+=2)),c},k.prototype.L=function(a){var c=this,b;return a.priority=0,b=0,this.O.forEach(function(d,e){b+=c.M(a,d.name,e+1)}),a.priority=b,a},d=function(a){void 0===a&&(a=[]),this.logger=new b("@barba/core"),this.S=!1,this.store=new k(a)},n={isRunning:{configurable:!0},hasAppear:{configurable:!0},hasSelf:{configurable:!0},shouldWait:{configurable:!0}},d.prototype.get=function(a,b){return this.store.resolve(a,b)},n.isRunning.get=function(){return this.S},n.hasAppear.get=function(){return this.store.appear.length>0},n.hasSelf.get=function(){return this.store.all.some(function(a){return"self"===a.name})},n.shouldWait.get=function(){return this.store.all.some(function(a){return a.to&&!a.to.route||a.sync})},d.prototype.doAppear=function(f){var b=f.data,g=f.transition,a,c,d;try{a=this;function e(b){a.S=!1}return c=g||{},a.S=!0,d=j(function(){return Promise.resolve(a.$("beforeAppear",b,c)).then(function(){return Promise.resolve(a.q(b,c)).then(function(){return Promise.resolve(a.$("afterAppear",b,c)).then(function(){})})})},function(d){return a.logger.error(d),Promise.resolve(a.$("appearCanceled",b,c)).then(function(){throw new Error("Transition error [appear]")})}),d&&d.then?d.then(e):e()}catch(a){return Promise.reject(a)}},d.prototype.doPage=function(d){var b=d.data,k=d.transition,i=d.page,g=d.wrapper,a,c,f,e;try{a=this;function h(b){a.S=!1}return c=k||{},f=!0===c.sync||!1,a.S=!0,e=j(function(){function e(){return Promise.resolve(a.$("before",b,c)).then(function(){function e(d){a.$("after",b,c)}var d=function(){if(f)return j(function(){return a.N(b,g),Promise.resolve(a.$("beforeLeave",b,c)).then(function(){return Promise.resolve(a.$("beforeEnter",b,c)).then(function(){return Promise.resolve(Promise.all([a.B(b,c),a.H(b,c)])).then(function(){return Promise.resolve(a.$("afterLeave",b,c)).then(function(){return Promise.resolve(a.$("afterEnter",b,c)).then(function(){a.I(b)})})})})})},function(){return Promise.resolve(a.$("leaveCanceled",b,c)).then(function(){return Promise.resolve(a.$("enterCanceled",b,c)).then(function(){throw new Error("Transition error [page][sync]")})})});{function h(e){return j(function(){var e=function(){if(!1!==d)return Promise.resolve(a.$("beforeEnter",b,c)).then(function(){return a.N(b,g),Promise.resolve(a.H(b,c,d)).then(function(){return Promise.resolve(a.$("afterEnter",b,c)).then(function(){})})})}();if(e&&e.then)return e.then(function(){})},function(){return Promise.resolve(a.$("leaveCanceled",b,c)).then(function(){return Promise.resolve(a.$("enterCanceled",b,c)).then(function(){throw new Error("Transition error [page][enter]")})})})}var d=!1,e=j(function(){return Promise.resolve(a.$("beforeLeave",b,c)).then(function(){return Promise.resolve(Promise.all([a.B(b,c),q(i,b.next)]).then(function(a){return a[0]})).then(function(e){return d=e,Promise.resolve(a.$("afterLeave",b,c)).then(function(){a.I(b)})})})},function(){return Promise.resolve(a.$("leaveCanceled",b,c)).then(function(){throw new Error("Transition error [page][leave]")})});return e&&e.then?e.then(h):h()}}();return d&&d.then?d.then(e):e()})}var d=function(){if(f)return Promise.resolve(q(i,b.next)).then(function(){})}();return d&&d.then?d.then(e):e()},function(b){throw a.logger.error(b),new Error("Transition error")}),e&&e.then?e.then(h):h()}catch(a){return Promise.reject(a)}},d.prototype.q=function(b,a){return f.do("appear",b,a),a.appear?p(a.appear)(b):Promise.resolve()},d.prototype.B=function(b,a){return f.do("leave",b,a),a.leave?p(a.leave)(b):Promise.resolve()},d.prototype.H=function(b,a,c){return f.do("enter",b,a),a.enter?p(a.enter)(b,c):Promise.resolve()},d.prototype.$=function(a,c,b){return f.do(a,c,b),b[a]?p(b[a])(c):Promise.resolve()},d.prototype.N=function(a,b){b.appendChild(a.next.container),f.do("nextAdded",a)},d.prototype.I=function(a){a.current.container.remove(),f.do("currentRemoved",a)},Object.defineProperties(d.prototype,n),E=function(b){var a=this;this.names=["beforeAppear","afterAppear","beforeLeave","afterLeave","beforeEnter","afterEnter"],this.byNamespace=new Map,0!==b.length&&(b.forEach(function(b){a.byNamespace.set(b.namespace,b)}),this.names.forEach(function(b){f[b](a.U(b),a)}),f.ready(this.U("beforeEnter"),this))},E.prototype.U=function(a){var b=this;return function(c){var e=a.match(/enter/i)?c.next:c.current,d=b.byNamespace.get(e.namespace);d&&d[a]&&d[a](c)}},Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(b){var a=this;do{if(a.matches(b))return a;a=a.parentElement||a.parentNode}while(null!==a&&1===a.nodeType)return null}),ac={container:void 0,html:void 0,namespace:void 0,url:{hash:void 0,href:void 0,path:void 0,query:{}}},a=function(){this.version="2.1.0",this.schemaPage=ac,this.Logger=b,this.logger=new b("@barba/core"),this.plugins=[],this.hooks=f,this.dom=r,this.helpers=ad,this.request=M,this.url=aa},z={data:{configurable:!0},wrapper:{configurable:!0}},a.prototype.use=function(a,c){var b=this.plugins;b.indexOf(a)>-1?this.logger.warn("Plugin ["+a.name+"] already installed."):"function"==typeof a.install?(a.install(this,c),b.push(a)):this.logger.warn("Plugin ["+a.name+'] has no "install" method.')},a.prototype.init=function(a){var p,m,e,k,q,i,g,f,n,o,c,j;if(void 0===a&&(a={}),p=a.transitions,void 0===p&&(p=[]),m=a.views,void 0===m&&(m=[]),e=a.prevent,void 0===e&&(e=null),k=a.timeout,void 0===k&&(k=2e3),q=a.requestError,i=a.cacheIgnore,void 0===i&&(i=!1),g=a.prefetchIgnore,void 0===g&&(g=!1),f=a.schema,void 0===f&&(f=h),n=a.debug,void 0===n&&(n=!1),o=a.logLevel,void 0===o&&(o="off"),b.setLevel(!0===n?"debug":o),Object.keys(f).forEach(function(a){h[a]&&(h[a]=f[a])}),this.D=q,this.timeout=k,this.cacheIgnore=i,this.prefetchIgnore=g,this.X=this.dom.getWrapper(),!this.X)throw new Error("[@barba/core] No Barba wrapper found");if(this.X.setAttribute("aria-live","polite"),this._(),c=this.data.current,!c.container)throw new Error("[@barba/core] No Barba container found");if(this.history=new l,this.cache=new Q(i),this.prevent=new Y(g),this.transitions=new d(p),this.views=new E(m),null!==e){if("function"!=typeof e)throw new Error("[@barba/core] Prevent should be a function");this.prevent.add("preventCustom",e)}this.history.add(c.url.href,c.namespace),this.cache.set(c.url.href,Promise.resolve(c.html)),this.F=this.F.bind(this),this.G=this.G.bind(this),this.W=this.W.bind(this),this.J(),this.plugins.forEach(function(a){return a.init()}),j=this.data,j.trigger="barba",j.next=j.current,this.hooks.do("ready",j),this.appear(),this._()},a.prototype.destroy=function(){this._(),this.K(),this.hooks.clear(),this.plugins=[]},z.data.get=function(){return this.V},z.wrapper.get=function(){return this.X},a.prototype.force=function(a){window.location.assign(a)},a.prototype.go=function(b,a,c){var d;if(void 0===a&&(a="barba"),!(d="popstate"===a?this.history&&this.url.getPath(this.history.current.url)===this.url.getPath(b):this.prevent.run("sameUrl",null,null,b))||this.transitions.hasSelf)return c&&(c.stopPropagation(),c.preventDefault()),this.page(b,a,d)},a.prototype.appear=function(){try{var a=this,b=function(){if(a.transitions.hasAppear){var b=j(function(){var b=a.V,c=a.transitions.get(b,{appear:!0});return Promise.resolve(a.transitions.doAppear({transition:c,data:b})).then(function(){})},function(b){a.logger.error(b)});if(b&&b.then)return b.then(function(){})}}();return b&&b.then?b.then(function(){}):void 0}catch(a){return Promise.reject(a)}},a.prototype.page=function(b,d,g){var a,e,c;try{a=this;function f(){var c,f;if("popstate"===d?a.history.add(b,a.data.next.namespace):a.history.push(b,a.data.next.namespace),c=a.data,a.hooks.do("page",c),f=j(function(){var b=a.transitions.get(c,{appear:!1,self:g});return Promise.resolve(a.transitions.doPage({data:c,page:e,transition:b,wrapper:a.X})).then(function(){a.Y(c),a._()})},function(b){a.history.cancel(),a.logger.error(b)}),f&&f.then)return f.then(function(){})}return a.transitions.isRunning?void a.force(b):(a.data.next.url=Object.assign({},{href:b},a.url.parse(b)),a.data.trigger=d,e=a.cache.has(b)?a.cache.get(b):a.cache.set(b,a.request(b,a.timeout,a.onRequestError.bind(a,d,"click"))),c=function(){if(a.transitions.shouldWait)return Promise.resolve(q(e,a.data.next)).then(function(){})}(),c&&c.then?c.then(f):f())}catch(a){return Promise.reject(a)}},a.prototype.onRequestError=function(e,d){for(var a=[],b=arguments.length-2,c,f;b-- >0;)a[b]=arguments[b+2];return c=a[0],f=a[1],this.cache.delete(c),!(this.D&&!1===this.D(e,d,c,f)||("click"===d&&this.force(c),1))},a.prototype.J=function(){!0!==this.prefetchIgnore&&(document.addEventListener("mouseover",this.F),document.addEventListener("touchstart",this.F)),document.addEventListener("click",this.G),window.addEventListener("popstate",this.W)},a.prototype.K=function(){!0!==this.prefetchIgnore&&(document.removeEventListener("mouseover",this.F),document.removeEventListener("touchstart",this.F)),document.removeEventListener("click",this.G),window.removeEventListener("popstate",this.W)},a.prototype.F=function(c){var d=this,b=this.Z(c),a;b&&(a=this.dom.getHref(b),this.prevent.checkUrl(a)||this.cache.has(a)||this.cache.set(a,this.request(a,this.timeout,this.onRequestError.bind(this,b,"enter")).catch(function(a){d.logger.error(a)})))},a.prototype.G=function(b){var a=this.Z(b);a&&this.go(this.dom.getHref(a),a,b)},a.prototype.W=function(){this.go(this.url.getHref(),"popstate")},a.prototype.Z=function(b){for(var a=b.target;a&&!this.dom.getHref(a);)a=a.parentNode;if(a&&!this.prevent.checkLink(a,b,a.href))return a},a.prototype._=function(){var a=this.url.getHref(),b={container:this.dom.getContainer(),html:this.dom.getHtml(),namespace:this.dom.getNamespace(),url:Object.assign({},{href:a},this.url.parse(a))};this.V={current:b,next:Object.assign({},this.schemaPage),trigger:void 0},this.hooks.do("reset",this.data)},a.prototype.Y=function(a){var b=this.dom.toDocument(a.next.html);document.title=b.title},Object.defineProperties(a.prototype,z),new a})