!function(b,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):b.Macy=a()}(this,function(){"use strict";var b,d,e,q,g,m,t,u,v,w,x,y,z,A,c,l,n,k,C,r,o,i,a;function J(b,c){var a=void 0;return function(){a&&clearTimeout(a),a=setTimeout(b,c)}}function I(b,d){for(var a=b.length,e=a,c=[];a--;)c.push(d(b[e-a-1]));return c}function j(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(window.Promise)return v(a,b,c);a.recalculate(!0,!0)}function E(a){for(var h=a.options,d=a.responsiveOptions,e=a.keys,g=a.docWidth,f=void 0,b=0,c;b<e.length;b++)c=parseInt(e[b],10),g>=c&&(f=h.breakAt[c],l(f,d));return d}function F(a){for(var h=a.options,d=a.responsiveOptions,e=a.keys,g=a.docWidth,f=void 0,b=e.length-1,c;b>=0;b--)c=parseInt(e[b],10),g<=c&&(f=h.breakAt[c],l(f,d));return d}function B(a){var d=a.useContainerForBreakpoints?a.container.clientWidth:window.innerWidth,b={columns:a.columns},e;return c(a.margin)?b.margin={x:a.margin.x,y:a.margin.y}:b.margin={x:a.margin,y:a.margin},e=Object.keys(a.breakAt),a.mobileFirst?E({options:a,responsiveOptions:b,keys:e,docWidth:d}):F({options:a,responsiveOptions:b,keys:e,docWidth:d})}function h(a){return B(a).columns}function f(a){return B(a).margin}function s(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],b=h(e),a=f(e).x,c=100/b,d,g;return i?1===b?"100%":(d="px","string"==typeof a&&(g=parseFloat(a),d=a.replace(g,""),a=g),a=(b-1)*a/b,"%"===d?c-a+"%":"calc("+c+"% - "+a+d+")"):c}function G(b,c){var i=h(b.options),d=0,e=void 0,a=void 0,g,j;return 1===++c?0:(a=f(b.options).x,g="px","string"==typeof a&&(j=parseFloat(a,10),g=a.replace(j,""),a=j),e=(a-(i-1)*a/i)*(c-1),d+=s(b.options,!1)*(c-1),"%"===g?d+e+"%":"calc("+d+"% + "+e+g+")")}function p(b){var a=0,c=b.container,e=b.rows;d(e,function(b){a=b>a?b:a}),c.style.height=a+"px"}function H(a,c){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],g=h(a.options),i=f(a.options).y;k(a,g,e),d(c,function(c){var d=0,e=parseInt(c.offsetHeight,10);isNaN(e)||(a.rows.forEach(function(b,c){b<a.rows[d]&&(d=c)}),c.style.position="absolute",c.style.top=a.rows[d]+"px",c.style.left=""+a.cols[d],a.rows[d]+=isNaN(e)?0:e+i,b&&(c.dataset.macyComplete=1))}),b&&(a.tmpRows=null),p(a)}function D(a,e){var g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=h(a.options),i=f(a.options).y;k(a,c,g),d(e,function(d){a.lastcol===c&&(a.lastcol=0);var e=n(d,"height");e=parseInt(d.offsetHeight,10),isNaN(e)||(d.style.position="absolute",d.style.top=a.rows[a.lastcol]+"px",d.style.left=""+a.cols[a.lastcol],a.rows[a.lastcol]+=isNaN(e)?0:e+i,a.lastcol+=1,b&&(d.dataset.macyComplete=1))}),b&&(a.tmpRows=null),p(a)}return b=function c(a,b){if(!(this instanceof c))return new c(a,b);if(a&&a.nodeName)return a;if(a=a.replace(/^\s*/,"").replace(/\s*$/,""),b)return this.byCss(a,b);for(var d in this.selectors)if(b=d.split("/"),new RegExp(b[1],b[2]).test(a))return this.selectors[d](a);return this.byCss(a)},b.prototype.byCss=function(a,b){return(b||document).querySelectorAll(a)},b.prototype.selectors={},b.prototype.selectors[/^\.[\w\-]+$/]=function(a){return document.getElementsByClassName(a.substring(1))},b.prototype.selectors[/^\w+$/]=function(a){return document.getElementsByTagName(a)},b.prototype.selectors[/^\#[\w\-]+$/]=function(a){return document.getElementById(a.substring(1))},d=function(b,c){for(var a=b.length,d=a;a--;)c(b[d-a-1])},e=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.running=!1,this.events=[],this.add(a)},e.prototype.run=function(){if(!this.running&&this.events.length>0){var a=this.events.shift();this.running=!0,a(),this.running=!1,this.run()}},e.prototype.add=function(){var b=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!a&&(Array.isArray(a)?d(a,function(a){return b.add(a)}):(this.events.push(a),void this.run()))},e.prototype.clear=function(){this.events=[]},q=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.instance=a,this.data=b,this},g=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.events={},this.instance=a},g.prototype.on=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(!a||!b)&&(Array.isArray(this.events[a])||(this.events[a]=[]),this.events[a].push(b))},g.prototype.emit=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c;if(!a||!Array.isArray(this.events[a]))return!1;c=new q(this.instance,b),d(this.events[a],function(a){return a(c)})},m=function(a){return!("naturalHeight"in a&&a.naturalHeight+a.naturalWidth===0)||a.width+a.height!==0},t=function(b,a){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(c,b){if(a.complete)return m(a)?c(a):b(a);a.addEventListener("load",function(){return m(a)?c(a):b(a)}),a.addEventListener("error",function(){return b(a)})}).then(function(a){c&&b.emit(b.constants.EVENT_IMAGE_LOAD,{img:a})}).catch(function(a){return b.emit(b.constants.EVENT_IMAGE_ERROR,{img:a})})},u=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return I(b,function(b){return t(a,b,c)})},v=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.all(u(a,b,c)).then(function(){a.emit(a.constants.EVENT_IMAGE_COMPLETE)})},w=function(a){return J(function(){a.emit(a.constants.EVENT_RESIZE),a.queue.add(function(){return a.recalculate(!0,!0)})},100)},x=function(a){if(a.container=b(a.options.container),a.container instanceof b||!a.container)return!!a.options.debug&&console.error("Error: Container not found");a.container.length&&(a.container=a.container[0]),a.options.container=a.container,a.container.style.position="relative"},y=function(a){a.queue=new e,a.events=new g(a),a.rows=[],a.resizer=w(a)},z=function(a){var c=b("img",a.container);window.addEventListener("resize",a.resizer),a.on(a.constants.EVENT_IMAGE_LOAD,function(){return a.recalculate(!1,!1)}),a.on(a.constants.EVENT_IMAGE_COMPLETE,function(){return a.recalculate(!0,!0)}),a.options.useOwnImageLoader||j(a,c,!a.options.waitForImages),a.emit(a.constants.EVENT_INITIALIZED)},A=function(a){x(a),y(a),z(a)},c=function(a){return a===Object(a)&&"[object Array]"!==Object.prototype.toString.call(a)},l=function(a,b){c(a)||(b.columns=a),c(a)&&a.columns&&(b.columns=a.columns),c(a)&&a.margin&&!c(a.margin)&&(b.margin={x:a.margin,y:a.margin}),c(a)&&a.margin&&c(a.margin)&&a.margin.x&&(b.margin.x=a.margin.x),c(a)&&a.margin&&c(a.margin)&&a.margin.y&&(b.margin.y=a.margin.y)},n=function(a,b){return window.getComputedStyle(a,null).getPropertyValue(b)},k=function(a,c){var d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b;if(a.lastcol||(a.lastcol=0),a.rows.length<1&&(d=!0),d){a.rows=[],a.cols=[],a.lastcol=0;for(b=c-1;b>=0;b--)a.rows[b]=0,a.cols[b]=G(a,b)}else if(a.tmpRows){a.rows=[];for(b=c-1;b>=0;b--)a.rows[b]=a.tmpRows[b]}else{a.tmpRows=[];for(b=c-1;b>=0;b--)a.tmpRows[b]=a.rows[b]}},C=function(a){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],f=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],c=e?a.container.children:b(':scope > *:not([data-macy-complete="1"])',a.container),g;return c=Array.from(c).filter(function(a){return null!==a.offsetParent}),g=s(a.options),d(c,function(a){e&&(a.dataset.macyComplete=0),a.style.width=g}),a.options.trueOrder?(D(a,c,e,f),a.emit(a.constants.EVENT_RECALCULATED)):(H(a,c,e,f),a.emit(a.constants.EVENT_RECALCULATED))},r=function(){return!!window.Promise},o=Object.assign||function(d){for(var a=1,b,c;a<arguments.length;a++){b=arguments[a];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d},Array.from||(Array.from=function(a){for(var b=0,c=[];b<a.length;)c.push(a[b++]);return c}),i={columns:4,margin:2,trueOrder:!1,waitForImages:!1,useImageLoader:!0,breakAt:{},useOwnImageLoader:!1,onInit:!1,cancelLegacy:!1,useContainerForBreakpoints:!1},!function(){try{document.createElement("a").querySelector(":scope *")}catch(a){!function(){var a,c,d;function b(b){return function(d){var c,e;return d&&a.test(d)?(c=this.getAttribute("id"),c||(this.id="q"+Math.floor(9e6*Math.random())+1e6),arguments[0]=d.replace(a,"#"+this.id),e=b.apply(this,arguments),null===c?this.removeAttribute("id"):c||(this.id=c),e):b.apply(this,arguments)}}a=/:scope\b/gi,c=b(Element.prototype.querySelector),Element.prototype.querySelector=function(a){return c.apply(this,arguments)},d=b(Element.prototype.querySelectorAll),Element.prototype.querySelectorAll=function(a){return d.apply(this,arguments)}}()}}(),a=function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;if(!(this instanceof a))return new a(b);this.options={},o(this.options,i,b),this.options.cancelLegacy&&!r()||A(this)},a.init=function(b){return console.warn("Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) "),new a(b)},a.prototype.recalculateOnImageLoad=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return j(this,b("img",this.container),!a)},a.prototype.runOnImageLoad=function(a){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=b("img",this.container);return this.on(this.constants.EVENT_IMAGE_COMPLETE,a),c&&this.on(this.constants.EVENT_IMAGE_LOAD,a),j(this,d,c)},a.prototype.recalculate=function(){var b=this,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return a&&this.queue.clear(),this.queue.add(function(){return C(b,c,a)})},a.prototype.remove=function(){window.removeEventListener("resize",this.resizer),d(this.container.children,function(a){a.removeAttribute("data-macy-complete"),a.removeAttribute("style")}),this.container.removeAttribute("style")},a.prototype.reInit=function(){this.recalculate(!0,!0),this.emit(this.constants.EVENT_INITIALIZED),window.addEventListener("resize",this.resizer),this.container.style.position="relative"},a.prototype.on=function(a,b){this.events.on(a,b)},a.prototype.emit=function(a,b){this.events.emit(a,b)},a.constants={EVENT_INITIALIZED:"macy.initialized",EVENT_RECALCULATED:"macy.recalculated",EVENT_IMAGE_LOAD:"macy.image.load",EVENT_IMAGE_ERROR:"macy.image.error",EVENT_IMAGE_COMPLETE:"macy.images.complete",EVENT_RESIZE:"macy.resize"},a.prototype.constants=a.constants,a})